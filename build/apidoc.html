<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/isaacs/cluster-master#readme"

    >cluster-master (v0.2.1)</a>
</h1>
<h4>A helper script for managing a cluster of node worker servers</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.cluster-master">module cluster-master</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.cluster-master.cluster-master">
            function <span class="apidocSignatureSpan"></span>cluster-master
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.cluster-master.quit">
            function <span class="apidocSignatureSpan">cluster-master.</span>quit
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.cluster-master.quitHard">
            function <span class="apidocSignatureSpan">cluster-master.</span>quitHard
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.cluster-master.resize">
            function <span class="apidocSignatureSpan">cluster-master.</span>resize
            <span class="apidocSignatureSpan">(n, cb_)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.cluster-master.restart">
            function <span class="apidocSignatureSpan">cluster-master.</span>restart
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.cluster-master" id="apidoc.module.cluster-master">module cluster-master</a></h1>


    <h2>
        <a href="#apidoc.element.cluster-master.cluster-master" id="apidoc.element.cluster-master.cluster-master">
        function <span class="apidocSignatureSpan"></span>cluster-master
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function clusterMaster(config) {
  if (typeof config === &#x22;string&#x22;) config = { exec: config }

  if (!config.exec) {
    throw new Error(&#x22;Must define a &#x27;exec&#x27; script&#x22;)
  }

  if (!cluster.isMaster) {
    throw new Error(&#x22;ClusterMaster answers to no one!\n&#x22;+
                    &#x22;(don&#x27;t run in a cluster worker script)&#x22;)
  }

  if (cluster._clusterMaster) {
    throw new Error(&#x22;This cluster has a master already&#x22;)
  }

  cluster._clusterMaster = module.exports

  if (typeof config.repl !== &#x27;undefined&#x27;) replAddressPath = config.repl  // allow null and false

  onmessage = config.onMessage || config.onmessage

  clusterSize = config.size || os.cpus().length

  minRestartAge = config.minRestartAge || minRestartAge

  env = config.env

  var masterConf = { exec: path.resolve(config.exec) }
  if (config.silent) masterConf.silent = true
  if (config.env) masterConf.env = config.env
  if (config.args) masterConf.args = config.args

  cluster.setupMaster(masterConf)

  if (config.signals !== false) {
    // sighup/sigint listeners
    setupSignals()
  }

  forkListener()

  // now make it the right size
  debug((replAddressPath) ? &#x27;resize and then setup repl&#x27; : &#x27;resize&#x27;)
  resize(setupRepl)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.cluster-master.quit" id="apidoc.element.cluster-master.quit">
        function <span class="apidocSignatureSpan">cluster-master.</span>quit
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function quit() {
  if (quitting) {
    debug(&#x22;Forceful shutdown&#x22;)
    // last ditch effort to force-kill all workers.
    Object.keys(cluster.workers).forEach(function (id) {
      var w = cluster.workers[id]
      if (w &#x26;&#x26; w.process) w.process.kill(&#x22;SIGKILL&#x22;)
    })
    process.exit(1)
  }

  debug(&#x22;Graceful shutdown...&#x22;)
  clusterSize = 0
  quitting = true
  restart(function () {
    debug(&#x22;Graceful shutdown successful&#x22;)
    process.exit(0)
  })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// methods
clusterMaster.resize(10)

// graceful rolling restart
clusterMaster.restart()

// graceful shutdown
clusterMaster.<span class="apidocCodeKeywordSpan">quit</span>()

// not so graceful shutdown
clusterMaster.quitHard()
```

## Methods
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.cluster-master.quitHard" id="apidoc.element.cluster-master.quitHard">
        function <span class="apidocSignatureSpan">cluster-master.</span>quitHard
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function quitHard() {
  quitting = true
  quit()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// graceful rolling restart
clusterMaster.restart()

// graceful shutdown
clusterMaster.quit()

// not so graceful shutdown
clusterMaster.<span class="apidocCodeKeywordSpan">quitHard</span>()
```

## Methods

### clusterMaster.resize(n)

Set the cluster size to `n`.  This will disconnect extra nodes and/or
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.cluster-master.resize" id="apidoc.element.cluster-master.resize">
        function <span class="apidocSignatureSpan">cluster-master.</span>resize
        <span class="apidocSignatureSpan">(n, cb_)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function resize(n, cb_) {
  if (typeof n === &#x27;function&#x27;) cb_ = n, n = clusterSize

  if (cb_)
    resizeCbs.push(cb_)

  if (resizing)
    return

  function cb() {
    console.error(&#x27;done resizing&#x27;)

    resizing = false
    var q = resizeCbs.slice(0)
    resizeCbs.length = 0
    q.forEach(function(c) {
      c()
    })
    if (clusterSize !== Object.keys(cluster.workers).length) {
      if (danger &#x26;&#x26; clusterSize === 0) {
        debug(&#x27;DANGER! something bad has happened&#x27;)
        process.exit(1)
      } else {
        danger = true
        debug(&#x27;DANGER! wrong number of workers&#x27;)
        setTimeout(resize, 1000)
      }
    } else {
      danger = false
    }
  }

  if (n &#x3e;= 0) clusterSize = n
  var current = Object.keys(cluster.workers)
  , c = current.length
  , req = clusterSize - c

  // avoid angry &#x22;listening&#x22; listeners
  cluster.setMaxListeners(clusterSize * 2)

  if (c === clusterSize) {
    resizing = false
    return cb()
  }

  var thenCnt = 0
  function then () {
    thenCnt ++
    return then2
  }
  function then2 () {
    if (--thenCnt === 0) {
      resizing = false
      return cb()
    }
  }

  // make us have the right number of them.
  if (req &#x3e; 0) while (req -- &#x3e; 0) {
    debug(&#x27;resizing up&#x27;, req)
    cluster.once(&#x27;listening&#x27;, then())
    cluster.fork(env)
  } else for (var i = clusterSize; i &#x3c; c; i ++) {
    var worker = cluster.workers[current[i]]
    debug(&#x27;resizing down&#x27;, current[i])
    worker.once(&#x27;exit&#x27;, then())
    if (worker &#x26;&#x26; worker.process.connected) {
      worker.disconnect()
    }
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                  console.error(&#x22;Message from %s %j&#x22;
                               , this.uniqueID
                               , msg)
                }
              })

// methods
clusterMaster.<span class="apidocCodeKeywordSpan">resize</span>(10)

// graceful rolling restart
clusterMaster.restart()

// graceful shutdown
clusterMaster.quit()
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.cluster-master.restart" id="apidoc.element.cluster-master.restart">
        function <span class="apidocSignatureSpan">cluster-master.</span>restart
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function restart(cb) {
  if (restarting) {
    debug(&#x22;Already restarting.  Cannot restart yet.&#x22;)
    return
  }

  restarting = true

  // graceful restart.
  // all the existing workers get killed, and this
  // causes new ones to be spawned.  If there aren&#x27;t
  // already the intended number, then fork new extras.
  var current = Object.keys(cluster.workers)
  , length = current.length
  , reqs = clusterSize - length

  var i = 0

  // if we&#x27;re resizing, then just kill off a few.
  if (reqs !== 0) {
    debug(&#x27;resize %d -&#x3e; %d, change = %d&#x27;,
                  current.length, clusterSize, reqs)

    return resize(clusterSize, function () {
      debug(&#x27;resize cb&#x27;)
      length = clusterSize
      graceful()
    })
  }

  // all the current workers, kill and then wait for a
  // new one to spawn before moving on.
  graceful()
  function graceful () {
    debug(&#x22;graceful %d of %d&#x22;, i, length)
    if (i &#x3e;= current.length) {
      debug(&#x22;graceful completion&#x22;)
      restarting = false
      return cb &#x26;&#x26; cb()
    }

    var first = (i === 0)
    , id = current[i++]
    , worker = cluster.workers[id]

    if (quitting) {
      if (worker &#x26;&#x26; worker.process.connected) {
        worker.disconnect()
      }
      return graceful()
    }

    // start a new one. if it lives for 2 seconds, kill the worker.
    if (first) {
      cluster.once(&#x27;listening&#x27;, function (newbie) {
        var timer = setTimeout(function () {
          newbie.removeListener(&#x27;exit&#x27;, skeptic)
          if (worker &#x26;&#x26; worker.process.connected) {
            worker.disconnect()
          }
          graceful()
        }, 2000)
        newbie.on(&#x27;exit&#x27;, skeptic)
        function skeptic () {
          debug(&#x27;New worker died quickly. Aborting restart.&#x27;)
          restarting = false
          clearTimeout(timer)
        }
      })
    } else {
      cluster.once(&#x27;listening&#x27;, function (newbie) {
        if (worker &#x26;&#x26; worker.process.connected) {
          worker.disconnect()
        }
      })
      graceful()
    }

    cluster.fork(env)
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                }
              })

// methods
clusterMaster.resize(10)

// graceful rolling restart
clusterMaster.<span class="apidocCodeKeywordSpan">restart</span>()

// graceful shutdown
clusterMaster.quit()

// not so graceful shutdown
clusterMaster.quitHard()
```
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
